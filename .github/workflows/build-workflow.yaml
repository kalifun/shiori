name: build workflow

on:
  release:
    types: [published]
jobs:
  release:
      name: Release on GitHub
      runs-on: ubuntu-latest
      steps:
        - name: Check out code
          uses: actions/checkout@v1
        - name: Validates GO releaser config
          uses: docker://goreleaser/goreleaser:latest
          with:
            args: check
        - name: Create release on GitHub
          uses: docker://goreleaser/goreleaser:latest
          with:
            args: release
          env:
            GITHUB_TOKEN: ${{secrets.TOKEN}}
            
  build:
      runs-on: ubuntu-latest
      name: Build image job
      steps:
        - name: Checkout master
          uses: actions/checkout@master
        - name: Login to DockerHub
          uses: docker/login-action@v1 
          with:
            username: ${{ secrets.DOCKER_USERNAME }}
            password: ${{ secrets.DOCKER_PASSWORD }}
        - name: Build and push Docker images
          uses: docker/build-push-action@v2.7.0
          with:
            push: true
            tag: kalifun/shiori:latest # 默认latest，可以针对平台，修改tag